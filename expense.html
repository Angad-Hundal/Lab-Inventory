<!Doctype html>
<html lang="en">

<html>

<head>
    <h1> Expenses </h1>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<br> </br>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<body>

    <div>
        <label> Current Month Spent: </label>
        <label> 100</label>
    </div>
    <br>

    <div>
        <label> Current Year Spent: </label>
        <label> 3600</label>
    </div>
    <br>

    <canvas id="expenseChart" style="width:100%;max-width:700px"></canvas>

    <script>
        /*
        var xValues = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
        var yValues = [1000, 500, 650, 200, 100, 200, 350, 100, 0, 0, 100, 400];
        var barColors = 'blue';

        new Chart("expenseChart", {
            type: "bar",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor: barColors,
                    data: yValues
                }]
            },
            options: {
                legend: { display: false },
            }
        });
        */


        // global variable that will hold the expense data of the year we select later
        let yearlyExpenses = [];

        function getExpenseData() {
            var http = new XMLHttpRequest;
            var url = "./getexpensedata"

            http.open("GET", url, true);
            http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            http.addEventListener('error', function (event) {
               alert ("something went wrong while getting");
            });

            http.onreadystatechange = function() { 
                console.log("function runnung");
                if(http.readyState == 4 && http.status == 200) {
                    var expenses = http.responseText;

                    var object = JSON.parse(expenses);
                    var rows_of_consupmtion_table = object["rows"];

                    let targetYear = 0; // select which year to make a graph of, here using the oldest  year (row 0)


                    // fill the yearlyExpenses array with the expenses for each month of the target year
                    yearlyExpenses[0]  = rows_of_consupmtion_table[targetYear]["Jan"];
                    yearlyExpenses[1]  = rows_of_consupmtion_table[targetYear]["Feb"];
                    yearlyExpenses[2]  = rows_of_consupmtion_table[targetYear]["Mar"];
                    yearlyExpenses[3]  = rows_of_consupmtion_table[targetYear]["Apr"];
                    yearlyExpenses[4]  = rows_of_consupmtion_table[targetYear]["May"];
                    yearlyExpenses[5]  = rows_of_consupmtion_table[targetYear]["Jun"];
                    yearlyExpenses[6]  = rows_of_consupmtion_table[targetYear]["Jul"];
                    yearlyExpenses[7]  = rows_of_consupmtion_table[targetYear]["Aug"];
                    yearlyExpenses[8]  = rows_of_consupmtion_table[targetYear]["Sept"];
                    yearlyExpenses[9]  = rows_of_consupmtion_table[targetYear]["Oct"];
                    yearlyExpenses[10] = rows_of_consupmtion_table[targetYear]["Nov"];
                    yearlyExpenses[11] = rows_of_consupmtion_table[targetYear]["Dec"];



                }
            }

            
            // set bar graph parameters
            var xValues = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
            var barColors = "Blue";

            // create the bar graph
            new Chart("expenseChart", {
                type: "bar",
                data: {
                    labels: xValues,
                    datasets: [{
                        backgroundColor: barColors,
                        data: yearlyExpenses
                    }]
                },
                options: {
                    legend: { display: false },
                }
            });
            


            http.send;
        }

        getExpenseData();
    </script>
</body>

</html>